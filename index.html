<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LightIPTV Player</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="screen active">
        <div class="login-container">
            <div class="login-header">
                <i class="fas fa-tv"></i>
                <h1>LightIPTV</h1>
                <p>Enter your Xtream credentials</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="server">Server URL</label>
                    <input type="url" id="server" placeholder="http://example.com:8080" required>
                </div>
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Your username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Your password" required>
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    Connect
                </button>
            </form>
            <div id="loginError" class="error-message"></div>
        </div>
    </div>

    <!-- Main Player Screen -->
    <div id="playerScreen" class="screen">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1><i class="fas fa-tv"></i> LightIPTV</h1>
            </div>
            <div class="header-right">
                <button id="theatreModeBtn" class="theatre-mode-btn" title="Theatre Mode">
                    <i class="fas fa-theater-masks"></i>
                    Theatre
                </button>
                <button id="darkModeToggle" class="dark-mode-toggle">
                    <i class="fas fa-moon"></i>
                    Dark Mode
                </button>
                <button id="resyncBtn" class="resync-btn" title="Resync IPTV Data">
                    <i class="fas fa-sync-alt"></i>
                    Resync
                </button>
                <button id="logoutBtn" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-title">
                        <h3>Categories</h3>
                        <button id="collapseBtn" class="collapse-btn" title="Collapse Sidebar">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    </div>
                    <div class="search-container">
                        <input type="text" id="categorySearchInput" placeholder="Search categories...">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
                <div class="category-tabs">
                    <button class="tab-btn" data-type="favorites">Favorites</button>
                    <button class="tab-btn active" data-type="live">Live TV</button>
                    <button class="tab-btn" data-type="movies">Movies</button>
                    <button class="tab-btn" data-type="series">Series</button>
                </div>
                <div id="categoryList" class="category-list">
                    <div id="favoritesSection" class="favorites-section" style="display: none;">
                        <div class="favorites-header">
                            <h3>Favorites</h3>
                        </div>
                        <div id="favoriteChannelsSection" class="favorite-channels-section">
                            <h4>Favorite Channels</h4>
                            <div id="favoriteChannelsList" class="favorite-items-list"></div>
                        </div>
                        <div id="favoriteCategoriesSection" class="favorite-categories-section">
                            <h4>Favorite Categories</h4>
                            <div id="favoriteCategoriesList" class="favorite-items-list"></div>
                        </div>
                    </div>
                    <div id="regularCategoryList" class="regular-category-list"></div>
                </div>
            </aside>

            <!-- Channel List -->
            <div class="channel-panel">
                <div class="panel-header">
                    <h3 id="panelTitle">Channels</h3>
                    <div class="view-controls">
                        <button id="gridViewBtn" class="view-btn active">
                            <i class="fas fa-th"></i>
                        </button>
                        <button id="listViewBtn" class="view-btn">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>
                <div class="channel-search-container">
                    <input type="text" id="searchInput" placeholder="Search channels...">
                    <i class="fas fa-search"></i>
                </div>
                <div id="channelList" class="channel-list grid-view"></div>
                <div id="loadingIndicator" class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    Loading...
                </div>
            </div>

            <!-- Video Player -->
            <div class="player-panel">
                <div class="player-header">
                    <div class="player-controls">
                        <button id="resizeBtn" class="control-btn" title="Resize Player">
                            <i class="fas fa-expand-arrows-alt"></i>
                        </button>
                        <button id="popoutBtn" class="control-btn" title="Pop Out Player">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        <button id="fullscreenBtn" class="control-btn" title="Fullscreen">
                            <i class="fas fa-expand"></i>
                        </button>
                        <div class="aspect-ratio-controls">
                            <button id="aspectRatio169" class="aspect-btn active" title="16:9 Aspect Ratio">
                                16:9
                            </button>
                            <button id="aspectRatio219" class="aspect-btn" title="21:9 Aspect Ratio (Cinema)">
                                21:9
                            </button>
                            <button id="aspectRatio43" class="aspect-btn" title="4:3 Aspect Ratio">
                                4:3
                            </button>
                        </div>
                        <div class="subtitle-controls">
                            <button id="subtitleBtn" class="control-btn" title="Subtitle Settings">
                                <i class="fas fa-closed-captioning"></i>
                            </button>
                            <button id="importSubtitleBtn" class="control-btn" title="Import Subtitle File">
                                <i class="fas fa-file-upload"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="player-container" id="playerContainer">
                    <video id="videoPlayer" controls poster="">
                        Your browser does not support the video tag.
                    </video>
                    <div id="playerOverlay" class="player-overlay">
                        <div class="overlay-content">
                            <i class="fas fa-play-circle"></i>
                            <p>Select a channel to start watching</p>
                        </div>
                    </div>
                    <!-- Resize Handles -->
                    <div class="resize-handle resize-handle-n" data-direction="n"></div>
                    <div class="resize-handle resize-handle-s" data-direction="s"></div>
                    <div class="resize-handle resize-handle-e" data-direction="e"></div>
                    <div class="resize-handle resize-handle-w" data-direction="w"></div>
                    <div class="resize-handle resize-handle-ne" data-direction="ne"></div>
                    <div class="resize-handle resize-handle-nw" data-direction="nw"></div>
                    <div class="resize-handle resize-handle-se" data-direction="se"></div>
                    <div class="resize-handle resize-handle-sw" data-direction="sw"></div>
                </div>
                <div class="now-playing">
                    <div id="nowPlayingInfo" class="now-playing-info">
                        <h4>No channel selected</h4>
                        <p>Choose a channel from the list</p>
                    </div>
                    <div id="resolutionIndicator" class="resolution-indicator">
                        <span id="resolutionBadge" class="resolution-badge">SD</span>
                        <span id="fpsBadge" class="fps-badge">60 FPS</span>
                        <div class="subtitle-indicator-controls">
                            <button id="subtitleIndicatorBtn" class="subtitle-indicator-btn" title="Subtitle Settings">
                                <i class="fas fa-closed-captioning"></i>
                            </button>
                            <button id="importSubtitleIndicatorBtn" class="subtitle-indicator-btn" title="Import Subtitle File">
                                <i class="fas fa-file-upload"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Collapsed Sidebar -->
        <div id="collapsedSidebar" class="collapsed-sidebar">
            <button id="expandBtn" class="expand-btn" title="Expand Sidebar">
                <i class="fas fa-chevron-right"></i>
            </button>
            <div class="collapsed-tabs">
                <div class="collapsed-tab" data-type="favorites" title="Favorites">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="collapsed-tab active" data-type="live" title="Live TV">
                    <i class="fas fa-broadcast-tower"></i>
                </div>
                <div class="collapsed-tab" data-type="movies" title="Movies">
                    <i class="fas fa-film"></i>
                </div>
                <div class="collapsed-tab" data-type="series" title="Series">
                    <i class="fas fa-tv"></i>
                </div>
            </div>
        </div>

        <!-- Channel Hover Overlay -->
        <div id="channelHoverOverlay" class="channel-hover-overlay">
            <div class="overlay-header">
                <h4>Quick Channel Select</h4>
            </div>
            <div id="overlayChannelList" class="overlay-channel-list"></div>
        </div>

        <!-- Theatre Mode Quick Channels -->
        <div id="theatreQuickChannels" class="theatre-quick-channels">
            <div class="theatre-channels-header">
                <h4>Quick Channels</h4>
                <button id="exitTheatreBtn" class="exit-theatre-btn" title="Exit Theatre Mode">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="theatreChannelList" class="theatre-channel-list"></div>
        </div>

        <!-- Theatre Mode Hover Trigger -->
        <div id="theatreHoverTrigger" class="theatre-hover-trigger"></div>

        <!-- Favorites Popup -->
        <div id="favoritesPopup" class="favorites-popup">
            <div class="favorites-popup-header">
                <h4>Favorite Channels</h4>
            </div>
            <div id="favoritesPopupList" class="favorites-popup-list"></div>
        </div>

        <!-- Subtitle Modal -->
        <div id="subtitleModal" class="subtitle-modal">
            <div class="subtitle-modal-content">
                <div class="subtitle-modal-header">
                    <h3>Subtitle Settings</h3>
                    <button id="closeSubtitleModal" class="close-modal-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="subtitle-modal-body">
                    <div class="subtitle-section">
                        <h4>Available Subtitles</h4>
                        <div id="providerSubtitleStatus" class="provider-subtitle-status">
                            <i class="fas fa-info-circle"></i>
                            <span>Checking for provider subtitles...</span>
                        </div>
                        <div id="subtitleList" class="subtitle-list">
                            <div class="subtitle-item disabled">
                                <span>No subtitles available</span>
                            </div>
                        </div>
                    </div>
                    <div class="subtitle-section">
                        <h4>Free Subtitle Sources</h4>
                        <p class="api-info">Search subtitles from Addic7ed - completely free, no API key required!</p>
                    </div>
                    <div class="subtitle-section">
                        <h4>Search TheSubDB</h4>
                        <div class="opensubtitles-search">
                            <input type="text" id="subtitleSearchInput" placeholder="Search for subtitles...">
                            <select id="subtitleLanguageSelect">
                                <option value="en">English</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="it">Italian</option>
                                <option value="pt">Portuguese</option>
                                <option value="ru">Russian</option>
                                <option value="zh">Chinese</option>
                                <option value="ja">Japanese</option>
                                <option value="ko">Korean</option>
                                <option value="ar">Arabic</option>
                                <option value="hi">Hindi</option>
                            </select>
                            <button id="searchSubtitlesBtn" class="search-btn">
                                <i class="fas fa-search"></i>
                                Search
                            </button>
                        </div>
                        <div id="searchResults" class="search-results"></div>
                    </div>
                    <div class="subtitle-section">
                        <h4>Subtitle Timing</h4>
                        <div class="subtitle-timing">
                            <div class="timing-info">
                                <p>Adjust subtitle timing if not synchronized properly</p>
                            </div>
                            <div class="timing-controls">
                                <div class="timing-input-group">
                                    <label for="subtitleOffsetSeconds">Seconds:</label>
                                    <input type="number" id="subtitleOffsetSeconds" value="0" min="-999" max="999" step="1">
                                </div>
                                <div class="timing-input-group">
                                    <label for="subtitleOffsetMilliseconds">Milliseconds:</label>
                                    <input type="number" id="subtitleOffsetMilliseconds" value="0" min="-999" max="999" step="1">
                                </div>
                                <div class="timing-buttons">
                                    <button id="applyTimingBtn" class="timing-btn">
                                        <i class="fas fa-sync"></i>
                                        Apply Timing
                                    </button>
                                    <button id="resetTimingBtn" class="timing-btn secondary">
                                        <i class="fas fa-undo"></i>
                                        Reset
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="subtitle-section">
                        <h4>Import Local File</h4>
                        <div class="file-import">
                            <input type="file" id="subtitleFileInput" accept=".srt,.vtt,.ass,.ssa" style="display: none;">
                            <button id="selectFileBtn" class="file-btn">
                                <i class="fas fa-file-upload"></i>
                                Select Subtitle File
                            </button>
                            <span id="selectedFileName" class="selected-file"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="screen loading-screen">
        <div class="loading-content">
                <i class="fas fa-spinner fa-spin"></i>
                <h2>Loading your content...</h2>
                <p id="loadingStatus">Connecting to server...</p>
                
                <!-- CORS Warning -->
                <div id="corsWarning" class="cors-warning" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p><strong>HTTPS Limitation:</strong> Some IPTV servers may not work on HTTPS sites due to browser security restrictions. If streams fail to load, try accessing this app via HTTP.</p>
                </div>
            
            <!-- Progress Details -->
            <div id="progressDetails" class="progress-details" style="display: none;">
                <!-- Live Channels Progress -->
                <div class="progress-item" id="liveProgress">
                    <div class="progress-header">
                        <span class="progress-label">
                            <i class="fas fa-tv"></i> Live Channels
                        </span>
                        <span class="progress-count" id="liveCount">0 / 0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="liveProgressFill"></div>
                    </div>
                    <div class="progress-status" id="liveStatus">Waiting...</div>
                </div>
                
                <!-- Movies Progress -->
                <div class="progress-item" id="moviesProgress">
                    <div class="progress-header">
                        <span class="progress-label">
                            <i class="fas fa-film"></i> Movies
                        </span>
                        <span class="progress-count" id="moviesCount">0 / 0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="moviesProgressFill"></div>
                    </div>
                    <div class="progress-status" id="moviesStatus">Waiting...</div>
                </div>
                
                <!-- Series Progress -->
                <div class="progress-item" id="seriesProgress">
                    <div class="progress-header">
                        <span class="progress-label">
                            <i class="fas fa-video"></i> Series
                        </span>
                        <span class="progress-count" id="seriesCount">0 / 0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="seriesProgressFill"></div>
                    </div>
                    <div class="progress-status" id="seriesStatus">Waiting...</div>
                </div>
                
                <!-- Overall Progress -->
                <div class="overall-progress">
                    <div class="progress-header">
                        <span class="progress-label">
                            <i class="fas fa-chart-line"></i> Overall Progress
                        </span>
                        <span class="progress-count" id="overallCount">0 / 3</span>
                    </div>
                    <div class="progress-bar overall">
                        <div class="progress-fill" id="overallProgressFill"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src='https://storage.ko-fi.com/cdn/scripts/overlay-widget.js'></script>
<script>
  kofiWidgetOverlay.draw('espeland', {
    'type': 'floating-chat',
    'floating-chat.donateButton.text': 'Support me',
    'floating-chat.donateButton.background-color': '#323842',
    'floating-chat.donateButton.text-color': '#fff'
  });
</script>
</body>
</html>